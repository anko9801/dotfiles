#!/usr/bin/env zsh
# OS-specific environment variables

{% if yadm.os == "Darwin" %}
# Homebrew
export HOMEBREW_NO_ANALYTICS=1
export HOMEBREW_NO_AUTO_UPDATE=1

# macOS specific paths
export PATH="/opt/homebrew/bin:/opt/homebrew/sbin:$PATH"

# Use GNU tools instead of BSD
export PATH="/opt/homebrew/opt/coreutils/libexec/gnubin:$PATH"
export PATH="/opt/homebrew/opt/gnu-sed/libexec/gnubin:$PATH"
export PATH="/opt/homebrew/opt/grep/libexec/gnubin:$PATH"

# iTerm2 integration
test -e "${HOME}/.iterm2_shell_integration.zsh" && source "${HOME}/.iterm2_shell_integration.zsh"

{% elif yadm.os == "Linux" or yadm.os == "WSL" %}
# Wayland/X11
export MOZ_ENABLE_WAYLAND=1
export QT_QPA_PLATFORM=wayland

# Linux specific paths
export PATH="/usr/local/sbin:/usr/sbin:/sbin:$PATH"

# Snap support
if [ -d "/snap/bin" ]; then
    export PATH="/snap/bin:$PATH"
fi

# Flatpak support
if [ -d "/var/lib/flatpak/exports/bin" ]; then
    export PATH="/var/lib/flatpak/exports/bin:$PATH"
fi
{% endif %}

{% if yadm.os == "WSL" %}
# WSL-specific environment variables
export BROWSER="wslview"
export WSL_HOST=$(tail -1 /etc/resolv.conf | cut -d' ' -f2 2>/dev/null || echo "localhost")

# Add Windows utilities to PATH
export PATH="$PATH:/mnt/c/Windows/System32:/mnt/c/Windows/System32/WindowsPowerShell/v1.0"
{% endif %}