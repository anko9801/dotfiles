# Declarative package management

packages:
  # ===== macOS =====
  macos:
    homebrew:
      # Core tools
      - git
      - curl
      - wget
      - tree
      - jq
      - yq
      
      # Shell & Terminal
      - zsh
      - tmux
      - sheldon
      - starship
      
      # Development
      - neovim
      - mise
      - uv
      - ruff
      
      # Git tools
      - gh
      - git-delta
      - gitui
      - ghq
      - gibo
      - gitleaks
      - git-lfs
      
      # Modern CLI
      - ripgrep
      - fd
      - bat
      - eza
      - fzf
      - zoxide
      - atuin
      - mcfly
      - duf
      - dust
      - tokei
      - sd
      - bottom
      - gomi
    
    homebrew_cask:
      - 1password-cli
    
    git_clone:
      - name: tpm
        repo: "https://github.com/tmux-plugins/tpm"
        dest: "$HOME/.tmux/plugins/tpm"

  # ===== Windows =====
  windows:
    winget:
      # System
      - Git.Git
      - Microsoft.PowerShell
      - Microsoft.VisualStudioCode
      
      # Development
      - Neovim.Neovim
      - GitHub.cli
      - astral-sh.uv
      
      # Modern CLI
      - BurntSushi.ripgrep.MSVC
      - sharkdp.fd
      - sharkdp.bat
      - dandavison.delta
      - junegunn.fzf
      - eza-community.eza
      - ajeetdsouza.zoxide
      - ellie.atuin
      - cantino.mcfly
      - muesli.duf
      - bootandy.dust
      - XAMPPRocky.Tokei
      - chmln.sd
      - Starship.Starship
      - ClementTsang.bottom
      
      # Security
      - AgileBits.1Password.CLI
      - extrawurst.gitui
      - Gitleaks.Gitleaks
    
    scoop:
      - ghq
    
    powershell:
      - name: mise
        script: "irm https://mise.run | iex"

  # ===== Debian/Ubuntu =====
  debian:
    apt:
      # Core
      - git
      - curl
      - wget
      - tmux
      - tree
      - jq
      - zsh
      - neovim
      - fzf
      - build-essential
      - software-properties-common
      - git-lfs
    
    apt_repository:
      - name: github-cli
        key: "https://cli.github.com/packages/githubcli-archive-keyring.gpg"
        repo: "deb [arch=$(dpkg --print-architecture) signed-by=/usr/share/keyrings/githubcli-archive-keyring.gpg] https://cli.github.com/packages stable main"
        package: gh
      
      - name: 1password
        key: "https://downloads.1password.com/linux/keys/1password.asc"
        repo: "deb [arch=$(dpkg --print-architecture) signed-by=/usr/share/keyrings/1password-archive-keyring.gpg] https://downloads.1password.com/linux/debian/$(dpkg --print-architecture) stable main"
        package: 1password-cli
        setup: |
          sudo mkdir -p /etc/debsig/policies/AC2D62742012EA22/
          curl -sS https://downloads.1password.com/linux/debian/debsig/1password.pol | sudo tee /etc/debsig/policies/AC2D62742012EA22/1password.pol
          sudo mkdir -p /usr/share/debsig/keyrings/AC2D62742012EA22
          curl -sS https://downloads.1password.com/linux/keys/1password.asc | sudo gpg --dearmor --output /usr/share/debsig/keyrings/AC2D62742012EA22/debsig.gpg
    
    github_release:
      - name: ripgrep
        repo: BurntSushi/ripgrep
        file: "ripgrep_VERSION-1_amd64.deb"
        type: deb
      - name: fd
        repo: sharkdp/fd
        file: "fd_VERSION_amd64.deb"
        type: deb
      - name: bat
        repo: sharkdp/bat
        file: "bat_VERSION_amd64.deb"
        type: deb
      - name: delta
        repo: dandavison/delta
        file: "git-delta_VERSION_amd64.deb"
        type: deb
      - name: eza
        repo: eza-community/eza
        file: "eza_amd64.deb"
        type: deb
      - name: duf
        repo: muesli/duf
        file: "duf_VERSION_linux_amd64.deb"
        type: deb
      - name: dust
        repo: bootandy/dust
        file: "dust-vVERSION-x86_64-unknown-linux-gnu.tar.gz"
        type: tar
      - name: tokei
        repo: XAMPPRocky/tokei
        file: "tokei-x86_64-unknown-linux-gnu.tar.gz"
        type: tar
      - name: sd
        repo: chmln/sd
        file: "sd-vVERSION-x86_64-unknown-linux-gnu"
        type: binary
      - name: gitui
        repo: extrawurst/gitui
        file: "gitui-linux-musl.tar.gz"
        type: tar
      - name: ghq
        repo: x-motemen/ghq
        file: "ghq_linux_amd64.zip"
        type: zip
      - name: gitleaks
        repo: gitleaks/gitleaks
        file: "gitleaks_VERSION_linux_x64.tar.gz"
        type: tar
    
    script:
      - name: sheldon
        script: "curl --proto '=https' -fLsS https://rossmacarthur.github.io/install/crate.sh | bash -s -- --repo rossmacarthur/sheldon --to ~/.local/bin"
      - name: starship
        script: "curl -sS https://starship.rs/install.sh | sh -s -- -y"
      - name: atuin
        script: "bash <(curl --proto '=https' --tlsv1.2 -sSf https://setup.atuin.sh)"
      - name: mcfly
        script: "curl -LSfs https://raw.githubusercontent.com/cantino/mcfly/master/ci/install.sh | sh -s -- --git cantino/mcfly"
      - name: mise
        script: "curl https://mise.run | sh"
      - name: uv
        script: "curl -LsSf https://astral.sh/uv/install.sh | sh"
      - name: gibo
        script: "curl -L https://raw.githubusercontent.com/simonwhitaker/gibo/main/gibo -o $HOME/.local/bin/gibo && chmod +x $HOME/.local/bin/gibo"
      - name: tpm
        script: "git clone https://github.com/tmux-plugins/tpm $HOME/.tmux/plugins/tpm"
    
    cargo:
      - zoxide

  # ===== Arch Linux =====
  arch:
    pacman:
      # Core
      - git
      - curl
      - wget
      - tmux
      - tree
      - jq
      - zsh
      - neovim
      - fzf
      - base-devel
      - yq
      
      # Modern CLI (most available in official repos!)
      - ripgrep
      - fd
      - bat
      - github-cli
      - eza
      - starship
      - zoxide
      - atuin
      - mcfly
      - git-delta
      - duf
      - dust
      - tokei
      - sd
      - sheldon
      - git-lfs
      - bottom
    
    aur:
      - 1password-cli
      - gibo
      - gitui
      - ghq
      - gitleaks
      - gomi
      - mise
      - uv
    
    git_clone:
      - name: tpm
        repo: "https://github.com/tmux-plugins/tpm"
        dest: "$HOME/.tmux/plugins/tpm"

  # ===== Fedora =====
  fedora:
    dnf:
      # Core
      - git
      - curl
      - wget
      - tmux
      - tree
      - jq
      - zsh
      - neovim
      - fzf
      - "@development-tools"
      
      # Available in repos
      - ripgrep
      - fd-find
      - bat
      - gh
      - git-delta
      - git-lfs
      - sheldon
    
    copr:
      - repo: atim/eza
        package: eza
      - repo: atim/zoxide
        package: zoxide
    
    rpm_repository:
      - name: 1password
        key: "https://downloads.1password.com/linux/keys/1password.asc"
        repo: |
          [1password]
          name=1Password Stable Channel
          baseurl=https://downloads.1password.com/linux/rpm/stable/$basearch
          enabled=1
          gpgcheck=1
          repo_gpgcheck=1
          gpgkey="https://downloads.1password.com/linux/keys/1password.asc"
        package: 1password-cli
    
    github_release:
      - name: duf
        repo: muesli/duf
        file: "duf_VERSION_linux_amd64.rpm"
        type: rpm
      - name: dust
        repo: bootandy/dust
        file: "dust-vVERSION-x86_64-unknown-linux-gnu.tar.gz"
        type: tar
      - name: tokei
        repo: XAMPPRocky/tokei
        file: "tokei-x86_64-unknown-linux-gnu.tar.gz"
        type: tar
      - name: sd
        repo: chmln/sd
        file: "sd-vVERSION-x86_64-unknown-linux-gnu"
        type: binary
      - name: gitui
        repo: extrawurst/gitui
        file: "gitui-linux-musl.tar.gz"
        type: tar
      - name: ghq
        repo: x-motemen/ghq
        file: "ghq_linux_amd64.zip"
        type: zip
      - name: gitleaks
        repo: gitleaks/gitleaks
        file: "gitleaks_VERSION_linux_x64.tar.gz"
        type: tar
    
    script:
      - name: starship
        script: "curl -sS https://starship.rs/install.sh | sh -s -- -y"
      - name: atuin
        script: "bash <(curl --proto '=https' --tlsv1.2 -sSf https://setup.atuin.sh)"
      - name: mcfly
        script: "curl -LSfs https://raw.githubusercontent.com/cantino/mcfly/master/ci/install.sh | sh -s -- --git cantino/mcfly"
      - name: mise
        script: "curl https://mise.run | sh"
      - name: uv
        script: "curl -LsSf https://astral.sh/uv/install.sh | sh"
      - name: gibo
        script: "curl -L https://raw.githubusercontent.com/simonwhitaker/gibo/main/gibo -o $HOME/.local/bin/gibo && chmod +x $HOME/.local/bin/gibo"
      - name: tpm
        script: "git clone https://github.com/tmux-plugins/tpm $HOME/.tmux/plugins/tpm"

# Post-install configurations
post_install:
  mise:
    - export PATH="$HOME/.local/bin:$PATH"
    - eval "$(mise activate bash)"
    - mise trust "$HOME/.config/mise/config.toml" 2>/dev/null || true
    - mise install --yes || warning "Some mise tools failed to install"
  
  1password-cli:
    - "[[ -f $HOME/.config/op/config ]] && chmod 600 $HOME/.config/op/config || true"
    - "[[ -f $HOME/.config/op/plugins.sh ]] && bash $HOME/.config/op/plugins.sh || true"
  
  gh:
    check: "command -v gh && command -v op && op plugin run -- gh extension list | grep -q github/gh-copilot"
    commands:
      - op plugin run -- gh extension install github/gh-copilot || true
  
  uv:
    - uv tool install ruff@latest || true