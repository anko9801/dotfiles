#!/usr/bin/env bash
# YADM Bootstrap - Main entry point

set -euo pipefail

# Check if we're running via yadm
if [[ -z "${YADM_BOOTSTRAP:-}" ]]; then
    echo "Error: This bootstrap should be run via 'yadm bootstrap'"
    echo "If you really want to run directly, set YADM_BOOTSTRAP=1"
    exit 1
fi

# Determine OS
OS="$(uname -s)"
BOOTSTRAP_DIR="$HOME/.config/yadm"

# Run OS-specific bootstrap
case "$OS" in
    Darwin)
        if [[ -x "$BOOTSTRAP_DIR/bootstrap##os.Darwin" ]]; then
            exec "$BOOTSTRAP_DIR/bootstrap##os.Darwin" "$@"
        else
            echo "Error: macOS bootstrap not found"
            exit 1
        fi
        ;;
    Linux)
        if [[ -x "$BOOTSTRAP_DIR/bootstrap##os.Linux" ]]; then
            exec "$BOOTSTRAP_DIR/bootstrap##os.Linux" "$@"
        else
            echo "Error: Linux bootstrap not found"
            exit 1
        fi
        ;;
    *)
        echo "Error: Unsupported OS: $OS"
        exit 1
        ;;
esac