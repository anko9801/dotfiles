#!/usr/bin/env bash
# Wi-Fi status script for tmux

if [[ "$OSTYPE" == "darwin"* ]]; then
    # macOS
    wifi_status=$(/System/Library/PrivateFrameworks/Apple80211.framework/Versions/Current/Resources/airport -I)
    
    if [[ "$wifi_status" =~ "state: running" ]]; then
        ssid=$(echo "$wifi_status" | grep " SSID" | cut -d : -f 2- | xargs)
        signal=$(echo "$wifi_status" | grep "agrCtlRSSI" | cut -d : -f 2 | xargs)
        
        if [[ -n "$ssid" ]]; then
            if [[ $signal -gt -50 ]]; then
                icon="ðŸ“¶"
            elif [[ $signal -gt -60 ]]; then
                icon="ðŸ“¶"
            elif [[ $signal -gt -70 ]]; then
                icon="ðŸ“¶"
            else
                icon="ðŸ“¶"
            fi
            echo "${icon} ${ssid}"
        else
            echo "ðŸ“µ No WiFi"
        fi
    else
        echo "ðŸ“µ WiFi Off"
    fi
elif [[ "$OSTYPE" == "linux-gnu"* ]]; then
    # Linux
    if command -v nmcli &> /dev/null; then
        wifi_info=$(nmcli -t -f ACTIVE,SSID,SIGNAL dev wifi | grep "^yes")
        
        if [[ -n "$wifi_info" ]]; then
            ssid=$(echo "$wifi_info" | cut -d : -f 2)
            signal=$(echo "$wifi_info" | cut -d : -f 3)
            
            if [[ $signal -gt 75 ]]; then
                icon="ðŸ“¶"
            elif [[ $signal -gt 50 ]]; then
                icon="ðŸ“¶"
            elif [[ $signal -gt 25 ]]; then
                icon="ðŸ“¶"
            else
                icon="ðŸ“¶"
            fi
            echo "${icon} ${ssid}"
        else
            echo "ðŸ“µ No WiFi"
        fi
    elif command -v iwconfig &> /dev/null; then
        # Fallback to iwconfig
        interface=$(iwconfig 2>/dev/null | grep -o "^\w*" | head -n 1)
        if [[ -n "$interface" ]]; then
            ssid=$(iwconfig "$interface" 2>/dev/null | grep ESSID | cut -d '"' -f 2)
            if [[ -n "$ssid" ]] && [[ "$ssid" != "off/any" ]]; then
                echo "ðŸ“¶ ${ssid}"
            else
                echo "ðŸ“µ No WiFi"
            fi
        fi
    fi
fi